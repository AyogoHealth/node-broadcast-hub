!function(){var a,b,c,d=function(a,b){return function(){return a.apply(b,arguments)}},e=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},f=[].slice;if(c=this,b=c.io,b||"undefined"==typeof require||(b=require("socket.io-client")),!b)throw Error("No Socket.IO found, be sure to include it!");a=function(){function a(a){this.options=null!=a?a:{},this._onError=d(this._onError,this),this._onDisconnected=d(this._onDisconnected,this),this._processMessage=d(this._processMessage,this),this._listeners={},this._channels=[],this.connect()}return a.prototype.connect=function(){var a=this;return this.client=b.connect(this.options.server,{"force new connection":!0}),this.client.on("hubMessage",this._processMessage),this.client.on("disconnect",this._onDisconnected),this.client.on("error",this._onError),this.client.on("connect",function(){var b,c,d,e,f;for(e=a._channels,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(a.subscribe(b));return f})},a.prototype.on=function(a,b){return b?(this._listeners[a]||(this._listeners[a]=[]),this._listeners[a].push(b)):void 0},a.prototype.once=function(a,b){var c;if(b)return c=function(){return b.apply(this,arguments),this.off(a,c)},this.on(a,c)},a.prototype.off=function(a,b){return!this._listeners[a]||e.call(this._listeners[a],b)<0?void 0:this._listeners[a].splice(this._listeners[a].indexOf(b),1)},a.prototype.emit=function(){var a,b,c,d,e,g,h;if(b=arguments[0],a=2<=arguments.length?f.call(arguments,1):[],this._listeners[b]){for(g=this._listeners[b],h=[],d=0,e=g.length;e>d;d++)c=g[d],h.push(c.apply(this,a));return h}},a.prototype._processMessage=function(a){return this.emit("message:"+a.channel,a.message),this.emit("message",a.channel,a.message)},a.prototype._onDisconnected=function(){return this.emit("disconnected")},a.prototype._onError=function(a){return this.emit("error",a)},a.prototype.disconnect=function(a){return this.once("disconnected",a),this.client.disconnect()},a.prototype.subscribe=function(a,b){var c=this;return this.client.emit("hubSubscribe",a,function(d){return d?(b&&b(d),void 0):(e.call(c._channels,a)<0&&c._channels.push(a),b?b():void 0)})},a}(),"undefined"!=typeof module?module.exports=a:c.BroadcastHubClient=a}.call(this);